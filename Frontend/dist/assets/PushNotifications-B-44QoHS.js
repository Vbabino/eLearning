import{a,_ as y,R as p,b as R,c as w,P as r,d as S,j as f,l as v}from"./index-BraKEzPG.js";import{b as j}from"./CRow-D-mEvV_I.js";import{T,c as W}from"./DefaultLayout-BTmS3a1y.js";import{u as O}from"./useForkedRef-BhHB2M03.js";import"./index.esm-CyJlCjTa.js";import"./cil-user-Ddrdy7PS.js";var d=a.forwardRef(function(e,c){var m=e.children,i=e.className,o=e.color,s=o===void 0?"primary":o,t=e.dismissible,n=e.variant,l=e.visible,u=l===void 0?!0:l,N=e.onClose,x=y(e,["children","className","color","dismissible","variant","visible","onClose"]),b=a.useRef(null),C=O(c,b),g=a.useState(u),E=g[0],h=g[1];return a.useEffect(function(){h(u)},[u]),p.createElement(T,{in:E,mountOnEnter:!0,nodeRef:b,onExit:N,timeout:150,unmountOnExit:!0},function(k){return p.createElement("div",R({className:w("alert",n==="solid"?"bg-".concat(s," text-white"):"alert-".concat(s),{"alert-dismissible fade":t,show:k==="entered"},i),role:"alert"},x,{ref:C}),m,t&&p.createElement(W,{onClick:function(){return h(!1)}}))})});d.propTypes={children:r.node,className:r.string,color:S.isRequired,dismissible:r.bool,onClose:r.func,variant:r.string,visible:r.bool};d.displayName="CAlert";const D=()=>{const[e,c]=a.useState([]);a.useEffect(()=>{(async()=>{try{const t=await v.get("/api/notifications/notifications/");c(t.data)}catch(t){console.error("Error fetching notifications:",t)}})();const o=localStorage.getItem("access");if(!o)return;const s=new WebSocket(`ws://144.126.234.87:8002/ws/notifications/?token=${o}`);return s.onopen=()=>{console.log("WebSocket connected")},s.onmessage=t=>{console.log("WebSocket message received:",t.data);const n=JSON.parse(t.data);n.message?c(l=>[...l,{id:n.id,content:n.message}]):console.error("Unexpected WebSocket message format:",n)},s.onclose=()=>{console.log("WebSocket closed")},()=>s.close()},[]);const m=async i=>{try{await v.delete(`/api/notifications/notifications/${i}/`),c(o=>o.filter(s=>s.id!==i))}catch(o){console.error("Error deleting notification:",o)}};return f.jsxs(j,{children:[f.jsx("h3",{children:"Notifications"}),e.length===0?f.jsx(d,{color:"info",children:"No notifications available"}):e.map((i,o)=>f.jsx(d,{color:"primary",dismissible:!0,onClose:()=>m(i.id),children:i.content},o))]})};export{D as default};
