import{a as r,l as f,j as a}from"./index-BraKEzPG.js";import{C,a as S}from"./CCardBody-g5mY4aaI.js";import{C as x}from"./CCardHeader-BDgx8Gn8.js";import{C as w,a as k}from"./CListGroupItem-qFc1SiDU.js";import{C as j,a as _}from"./CInputGroupText-Dcp3u1-q.js";import{C as y}from"./CFormInput-DI9PoxJV.js";import{a as b}from"./CRow-D-mEvV_I.js";import"./CFormControlWrapper-BEyPui5m.js";const v=()=>{const[p,d]=r.useState([]),[n,l]=r.useState(""),[c,u]=r.useState({}),m=localStorage.getItem("id");r.useEffect(()=>{const e=localStorage.getItem("access");if(!e)return;const s=new WebSocket(`ws://144.126.234.87:8002/ws/chat/?token=${e}`);return s.onopen=()=>{console.log("WebSocket connected")},s.onmessage=async o=>{console.log("ðŸ“© WebSocket message received:",o.data);const t=JSON.parse(o.data);if(console.log("Parsed data:",t),!t.message){console.error('ðŸš¨ WebSocket message missing "message" field:',t);return}if(!t.sender_id){console.warn('âš ï¸ WebSocket message missing "sender_id":',t),d(i=>[...i,{sender_id:"Unknown",message:t.message}]);return}c[t.sender_id]||await g(t.sender_id),d(i=>[...i,{sender_id:t.sender_id,message:t.message}])},s.onclose=()=>{console.log("WebSocket closed")},window.chatSocket=s,g(m),()=>s.close()},[]);const h=()=>{if(n.trim()){const e=JSON.stringify({message:n,sender_id:m});console.log("ðŸ“¤ Sending message:",e),window.chatSocket.send(e),l("")}},g=async e=>{if(!c[e])try{const s=await f.get(`/api/auth/user/${e}/`);u(o=>({...o,[e]:`${s.data.first_name} ${s.data.last_name}`}))}catch(s){console.error("Error fetching user:",s)}};return a.jsxs(C,{children:[a.jsx(x,{children:"Chat with e-learners!"}),a.jsxs(S,{children:[a.jsx(w,{children:p.map((e,s)=>a.jsxs(k,{children:[a.jsxs("strong",{children:[c[e.sender_id]||"Unknown User",":"]})," ",e.message]},s))}),a.jsxs(j,{className:"mt-3",children:[a.jsx(y,{placeholder:"Type a message...",value:n,onChange:e=>l(e.target.value)}),a.jsx(_,{children:a.jsx(b,{color:"primary",onClick:h,children:"Send"})})]})]})]})};export{v as default};
